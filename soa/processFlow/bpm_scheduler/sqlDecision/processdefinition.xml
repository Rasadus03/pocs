<?xml version="1.0" encoding="UTF-8"?>
  
<process-definition name="sqlDecision">

   <start-state name="start">
      <event type='node-leave'>
        <script>
            System.out.println("start.node-leave :  aimcoDomain = "+ executionContext.getContextInstance().getVariable("aimcoDomain"));
        </script>
      </event>
      <transition to="getSQLJobInfo"></transition>
   </start-state>

   <state name="getSQLJobInfo">
      <event type='node-enter'>
        <script>
            System.out.println("getSQLJobInfo.node-enter :  aimcoDomain = "+ executionContext.getContextInstance().getVariable("aimcoDomain"));
        </script>
      </event>
      <timer name='reminder'  duedate='5 seconds' >
        <action name="getSQLJobInfo" class="com.aimco.GetSQLJobInfoAction" />
      </timer>
      <transition to="fireSQLRules"></transition>
   </state>
   <node name="fireSQLRules">
      <event type='node-enter'>
        <script>
            System.out.println("fireSQLRules.node-enter :  aimcoDomain = "+ executionContext.getContextInstance().getVariable("aimcoDomain"));
        </script>
      </event>
      <action name="fireSQLRules" class="com.aimco.FireSQLRulesAction" />
      <transition to="makeDecision"></transition>
   </node>
   <decision name="makeDecision">
      <event type='node-enter'>
        <script>
            System.out.println("makeDecision.node-enter :  branchName = "+ executionContext.getContextInstance().getVariable("branchName"));
        </script>
      </event>
      <transition to="endNode"></transition>
      <transition to="getSQLJobInfo" >
            <condition expression='#{branchName == "getSQLJobInfo"}'></condition>
      </transition>
      <transition to="startSQLJob">
            <condition expression='#{branchName == "getSQLJobInfo"}'></condition>
        </transition>
   </decision>
   <node name="startSQLJob">
      <action name="startSQLJob" class="org.jboss.soa.esb.services.jbpm.actionhandlers.EsbActionHandler">
         <esbCategoryName>aimco</esbCategoryName>
         <esbServiceName>startSQLJob</esbServiceName>                    
         <bpmToEsbVars>
             <mapping bpm="aimcoDomain" esb="aimcoDomain" />
         </bpmToEsbVars>
         <esbToBpmVars>
             <mapping esb="aimcoDomain" bpm="aimcoDomain"/>
         </esbToBpmVars>
      </action>
      <transition to="endNode"></transition>
   </node>
   <end-state name="endNode"></end-state>
</process-definition>
