package com.wavechain.jaxws;

import java.util.List;
import java.util.ArrayList;
import java.util.Iterator;
import java.net.URL;

import javax.xml.namespace.QName;
import javax.xml.ws.Service;
import javax.xml.ws.BindingProvider;
import javax.xml.ws.WebServiceRef;

import org.apache.log4j.Logger;

/*
    Note:  this client will need in its classpath the following file:
        -- META-INF/standard-jaxws-client-config.xml
        -- located in:  $JBOSS_HOME/client/jbossws-client.jar
*/
public class JaxWSClient {
    
    private static final String WSDL_URL = "com.wavechain.wsdl_url";
    private static Logger log = Logger.getLogger(JaxWSClient.class);
    private static String wsdlUrl = "http://ratwater:8080/jaxws/JaxWS_Service?wsdl";
    private static String namespaceURI = "http://jaxws.wavechain.com";
    private static String serviceName = "jaxwsWsdl_Service";
    private static List urlList = new ArrayList();
    private static int loops = 1;

    public static void main(String[] args){
        String wsdlUrlProp = System.getProperty(WSDL_URL);
        if(wsdlUrlProp != null)
            wsdlUrl = wsdlUrlProp;
        log.info("main() wsdlUrl = "+wsdlUrl);

        try {
            QName qname = new QName(namespaceURI, serviceName);
            URL url = new URL(wsdlUrl);
            Service service = Service.create(url, qname); 
            IJaxWS_Service wsPort = service.getPort(IJaxWS_Service.class);
            ((BindingProvider)wsPort).getRequestContext().put(BindingProvider.USERNAME_PROPERTY, "admin");
            ((BindingProvider)wsPort).getRequestContext().put(BindingProvider.PASSWORD_PROPERTY, "admin");

            for(int x = 0; x < loops; x++) {
                callWebService(wsPort);
            }
        } catch (Exception x) {
            x.printStackTrace();
        }
    }

    public static void callWebService(IJaxWS_Service wsPort) {
        try {
          String response = wsPort.echo("Azra Olivia is 4 years old");
          log.info("callWebServices() return = "+response);

/*  Appears that data structures are getting exchanged
    However, the elements in the data structure are not making it over the wire
*/
          List aList = new ArrayList();
          aList.add("element");
          //java.util.HashMap hashResponse = wsPort.exchangeComplexDataTypes(aList);
          //log.info("callWebServices() hashResponse size  = "+hashResponse.size());
        } catch(Throwable x){
            x.printStackTrace();
        }
    }
}
